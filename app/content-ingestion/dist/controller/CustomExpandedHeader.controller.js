sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/m/MessageBox","sap/ui/core/BusyIndicator","./service"],function(e,t,a,o){"use strict";return e.extend("com.scb.treasury.contentingestion.controller.CustomExpandedHeader",{onInit:function(){},_getBaseURL:function(){const e=sap.ui.core.Component.getOwnerComponentFor(this.base.getView()).getManifestEntry("/sap.app/id").replaceAll(".","/");return sap.ui.require.toUrl(e)},_getText:function(e,t){return this.base.getOwnerComponent().getModel("i18n").getResourceBundle().getText(e,t)},onFileChange:function(e){const a=e.getSource();const o=e.getParameter("files")[0];if(!o||o.type!=="application/pdf"){t.error(this._getText("fileTypeError"));a.setValue("");return}this.file=o},calculateFileHash:async function(e){const t=await e.arrayBuffer();const a=await crypto.subtle.digest("SHA-256",t);const o=Array.from(new Uint8Array(a));return o.map(e=>e.toString(16).padStart(2,"0")).join("")},onUploadFile:async function(){try{a.show(0);const e=this.base.byId("__fileUploader");const t=e.getDomRef("fu").files[0];const o=this.base.byId("__checkboxQA").getSelected();const s=this.base.byId("__checkboxSummary").getSelected();if(!o&&!s){sap.m.MessageToast.show("Please select at least one checkbox.");return}if(!t){sap.m.MessageToast.show("Please select a file to upload.");return}const n=await this.calculateFileHash(t);const r=t.name;const i=t.type;const c=`./v2/odata/v4/catalog/Content('${n}')/content`;const l=[];if(o){l.push({keyID:`QA_${n}`,fileName:r,mediaType:i,tagType:"QA",status:"SUBMITTED",url:c})}if(s){l.push({keyID:`SUM_${n}`,fileName:r,mediaType:i,tagType:"SUMMARY",status:"DRAFT",url:c})}if(e.getValue()){e.setValueState("None");await this._postInitialFileRecord(l);e.setValue("");this.base.byId("__checkboxQA").setSelected(false);this.base.byId("__checkboxSummary").setSelected(false)}else{e.setValueState("Error")}}catch(e){console.error(e);t.error(this._getText("fileUploadError"),{details:e})}finally{a.hide()}},_readFileAsBase64:function(e){return new Promise((t,a)=>{const o=new FileReader;o.onload=e=>t(e.target.result.split(",")[1]);o.onerror=a;o.readAsDataURL(e)})},_postInitialFileRecord:async function(e){try{const t=this.getView().getModel();const a=await o.createContent(this.base,{initialData:JSON.stringify(e)},"CatalogService.EntityContainer/createContent",t);if(a){const e=this.base.getExtensionAPI().getModel();e.refresh()}}catch(e){this._handleException(e,"_postInitialInvoiceRecord")}},_handleException:function(e,a){const o=e instanceof Error?{"Error Location":a,name:e.name,message:e.message,stack:e.stack}:{"Error Location":a,...e};console.error("Handled Error:",o);t.error("An unexpected error occurred.")}})});
//# sourceMappingURL=CustomExpandedHeader.controller.js.map