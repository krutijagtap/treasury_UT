sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/PDFViewer","sap/m/BusyDialog","sap/m/MessageToast"],(e,t,s,a,n)=>{"use strict";return e.extend("treasuryui.controller.TreasuryMainView",{onInit(){let e=new sap.ui.model.json.JSONModel;this.getView().setModel(e)},getBaseURL:function(){var e=this.getOwnerComponent().getManifestEntry("/sap.app/id");var t=e.replaceAll(".","/");var s=jQuery.sap.getModulePath(t);return s},onfetchCSRF:async function(e){const t=await fetch(e,{method:"GET",headers:{"X-CSRF-Token":"Fetch"}});const s=t.headers.get("X-CSRF-Token");if(!s){throw new Error("Failed to fetch CSRF token")}return s},onSelectDocument:function(e){var t=e.getSource();var s=t.getSelectedItems();var a=s.map(function(e){return"File: "+e.getText()});a.push("Question: ");var n=a.join("\n");this.byId("chatFeedInput").setValue(n)},onUserChat:async function(){const e=this.getOwnerComponent().getModel("chatModel");const t=this.getView();const s=this.byId("chatFeedInput").getValue();e.setSubmit(false);e.setvisibleResult(false);const a=new sap.m.BusyDialog({title:"Busy Indicator",text:"Generating response. Please standby.."});a.open();t.setBusy(true);await Promise.resolve();try{const t=await this.onfetchData(s);e.setResult(t);e.setvisibleResult(true);console.log(t)}catch(e){console.error("Chat fetch error:",e);sap.m.MessageToast.show("Failed to get response.")}finally{a.close();t.setBusy(false)}},onfetchData:async function(e){const t=this.getBaseURL()+"/odata/v4/catalog/chatResponse";const s=this.getBaseURL()+"/odata/v4/catalog/";const a=await this.onfetchCSRF(s);try{let s=await fetch(t,{method:"POST",headers:{"X-CSRF-Token":a,"Content-Type":"application/json"},body:JSON.stringify({prompt:e})});if(!s.ok){throw new Error(`HTTP error! Status: ${s.status}`)}const n=await s.json();const o=n.d.chatResponse.result;console.log("API Response:",o);return o}catch(e){console.error("API Error:",e)}},onGenerateSummary:async function(e){var s=this.byId("multiCombo").getSelectedItems();var a=this.byId("chatFeedInput");if(s.length>1||s.length==0){t.error("Please select a single file to Generate Summary.");return}var n=s[0].getText();a.setValue(`Research Summary: ${n}`);this._callSummaryApi("Research Summary: C-PressRelease-2Q25.pdf")},getBaseURL:function(){var e=this.getOwnerComponent().getManifestEntry("/sap.app/id");var t=e.replaceAll(".","/");var s=jQuery.sap.getModulePath(t);return s},_callSummaryApi:async function(e){const t=new a({text:"Fetching summary..."});t.open();var s=this.getBaseURL()+"/user-api/currentUser";try{const a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})});if(!a.ok){throw new Error(`HTTP error! Status: ${a.status}`)}const r=await a.json();if(r.success&&Array.isArray(r.summary_files)){var o=this._displayPdfFiles(r.summary_files);t.close();return o}else{n.show("No summaries returned.")}}catch(e){}},_displayPdfFiles:function(e){const t=this.byId("pdfContainer");t.removeAllItems();e.forEach(e=>{const s=this._createPdfViewer(e.data,e.filename);t.addItem(s)})},_createPdfViewer:function(e,t){const a=atob(e);const n=new Uint8Array(a.length);for(let e=0;e<a.length;e++){n[e]=a.charCodeAt(e)}const o=new Blob([n],{type:"application/pdf"});const r=URL.createObjectURL(o);return new s({source:r,title:t,width:"100%",height:"600px",showDownloadButton:true})}})});
//# sourceMappingURL=TreasuryMainView.controller.js.map